<script setup>
import gsap from 'gsap';
let ctx;
let shapes;
let letters;
let main = ref();
const end_xpos = [0, 18, 35, 50];
const end_dirs = [-1, 1, 1, -1];
const w = 18;

onMounted(() => {
  ctx = gsap.context((self) => {
    shapes = gsap.utils.toArray('.logo-half');
    const letter = self.selector('path');
    letters = gsap.utils.toArray(letter);

    setupLoader();
  }, main.value);

  setTimeout(function () {
    removeLoader();
  }, 1200);
});

onUnmounted(() => {
  ctx.revert();
});

const setupLoader = () => {
  // set up for loader animation
  shapes.forEach((shape, i) => {
    gsap.set(shape, { x: i * (w + 2), scaleX: 1 });

    // loading animation
    gsap.fromTo(
      shape,
      { scaleY: 0.5 },
      {
        duration: 0.3,
        delay: (shapes.length - i) * -0.05,
        scaleY: 1.5,
        ease: 'quad.inOut',
        repeat: -1,
        yoyo: true,
      }
    );
  });

  gsap.set(letters, { opacity: 0 });
};

const removeLoader = () => {
  // move shapes into logo lockup
  shapes.forEach((shape, i) => {
    gsap.to(shape, {
      overwrite: 'auto',
      duration: 0.5,
      delay: i * 0.1,
      x: end_xpos[i],
      scaleY: 1,
      scaleX: end_dirs[i],
      ease: 'back.out(3)',
    });
  });

  // show logo text
  shuffle(letters);
  gsap.fromTo(
    letters,
    { y: 20, opacity: 0 },
    {
      duration: 0.75,
      opacity: 1,
      y: 0,
      stagger: 0.03,
      ease: 'back.out(2)',
    }
  );
};

// watch for page change to refresh loader
const loader_status = useState('loader_status');
watch(loader_status, () => {
  if (loader_status.value == 'refresh') {
    setupLoader();
    setTimeout(function () {
      removeLoader();
    }, 1200);
    loader_status.value = 'off';
  }
});
</script>

<template>
  <div ref="main">
    <svg viewBox="0 0 110 68" class="use-theme vis">
      <g class="logo-letters">
        <path
          d="M104.08,63.2c-1.138,0-2.141-.269-2.997-.7953-.857-.5497-1.5218-1.2749-2.0064-2.1989-.462-.924-.6987-1.9299-.6987-3.041,0-1.1112.2254-2.1405.6762-3.0411.4508-.924,1.0929-1.6492,1.9379-2.1755.846-.5497,1.83701-.8187,2.97601-.8187,1.138,0,2.152.269,2.975.8187.845.5263,1.487,1.2515,1.938,2.1755.451.9006.676,1.9182.676,3.0411v.7017h-9.444c.091.6901.305,1.3217.631,1.8948.35.5615.80099,1.0176,1.375,1.3568.575.3275,1.229.4912,1.98399.4912.8,0,1.465-.1754,2.006-.538.541-.3743.958-.8538,1.262-1.4269h1.848c-.394,1.0409-1.014,1.9065-1.871,2.5732-.845.6549-1.927.9824-3.268.9824ZM100.136,56.2291h7.663c-.146-.9942-.552-1.8364-1.217-2.5031-.665-.6666-1.533-1.0058-2.614-1.0058-1.082,0-1.95.3392-2.61501,1.0058-.642.6667-1.048,1.5089-1.217,2.5031Z"
        />
        <path
          d="M80.29,63.0129v-11.6963h1.6904v1.7778c.2592-.4678.6649-.9123,1.2171-1.3333.5522-.4211,1.296-.6316,2.2088-.6316.7551,0,1.4425.2105,2.07359.6316.6423.4093,1.14951.9825,1.5101,1.731.1465-.269.3831-.5848.6987-.9591.32681-.3743.755-.7018,1.2847-.9825.5296-.2807,1.16071-.421,1.8932-.421.7326,0,1.3974.1988,2.0285.5848.6311.386,1.1382.9474,1.53259,1.6843.4057.7134.6086,1.5673.6086,2.5497v7.0646h-1.6904v-7.0178c0-.9825-.2705-1.7661-.8114-2.3626-.5297-.6082-1.1833-.9123-1.9834-.9123s-1.5439.2924-2.1412.8655c-.5973.5731-.9015,1.3919-.9015,2.4328v6.9944h-1.6904v-7.0178c0-.9825-.2705-1.7661-.8114-2.3626-.5297-.6082-1.1833-.9123-1.9834-.9123-.8002,0-1.5439.2924-2.1412.8655-.59731.5731-.9016,1.3919-.9016,2.4328v6.9944h-1.6904Z"
        />
        <path
          d="M73.2585,63.2c-1.1382,0-2.1299-.269-2.9751-.7953-.8452-.5497-1.4875-1.2749-1.9383-2.1989s-.6762-1.9299-.6762-3.041c0-1.1112.2254-2.1405.6762-3.0411.4508-.924,1.0931-1.6492,1.9383-2.1755.8452-.5497,1.8369-.8187,2.9751-.8187s2.1525.269,2.9752.8187c.8452.5263,1.4875,1.2515,1.93829,2.1755.45081.9006.6762,1.9182.6762,3.0411,0,1.1228-.2254,2.117-.6762,3.041-.4508.924-1.09309,1.6492-1.93829,2.1989-.8227.5263-1.81441.7953-2.9752.7953ZM73.2585,61.6093c.8452,0,1.544-.1988,2.1187-.6082.58601-.4093,1.02551-.9474,1.3298-1.614.3042-.6901.4507-1.427.4507-2.2223,0-.7954-.1465-1.5557-.4507-2.2223-.3043-.6667-.7438-1.2048-1.3298-1.6141-.5747-.4094-1.2735-.6082-2.1187-.6082s-1.5326.1988-2.1186.6082c-.586.4093-1.0255.9474-1.3298,1.6141-.3042.6666-.4508,1.4152-.4508,2.2223,0,.807.1466,1.5322.4508,2.2223.30431.6666.7438,1.2047,1.3298,1.614.586.4094,1.296.6082,2.1186.6082Z"
        />
        <path
          d="M53.7969,63.0129v-15.4859h1.6904v6.8774h8.6774v-6.8774h1.6904v15.4859h-1.6904v-6.9008h-8.6774v6.9008h-1.6904Z"
        />
        <path
          d="M41.4561,63.0129v-11.6963h1.6904v1.8246c.4057-.5614.9015-1.0409,1.4875-1.4269.586-.386,1.3411-.5848,2.2539-.5848.7776,0,1.5101.1988,2.1862.5848.6875.3743,1.2509.9474,1.6679,1.7076.4395.7486.6536,1.6726.6536,2.7838v6.8072h-1.6904v-6.7605c0-1.0643-.293-1.9064-.879-2.5497-.586-.655-1.341-.9825-2.2764-.9825-.6311,0-1.2058.152-1.7129.4444-.5072.2924-.9241.7135-1.2397,1.2632-.3042.5264-.4507,1.1463-.4507,1.848v6.7371h-1.6904Z"
        />
        <path
          d="M34.7062,63.2c-1.1382,0-2.1412-.269-2.9976-.7953-.8565-.5497-1.5214-1.2749-2.006-2.1989-.462-.924-.6987-1.9299-.6987-3.041,0-1.1112.2254-2.1405.6762-3.0411.4507-.924,1.0931-1.6492,1.9383-2.1755.8452-.5497,1.8369-.8187,2.9751-.8187s2.1525.269,2.9751.8187c.8452.5263,1.4876,1.2515,1.9383,2.1755.4508.9006.6762,1.9182.6762,3.0411v.7017h-9.4437c.0901.6901.3043,1.3217.6311,1.8948.3493.5615.8001,1.0176,1.3748,1.3568.5748.3275,1.2284.4912,1.9834.4912.8002,0,1.4651-.1754,2.006-.538.5409-.3743.9579-.8538,1.2622-1.4269h1.8481c-.3944,1.0409-1.0142,1.9065-1.8707,2.5732-.8452.6549-1.9271.9824-3.2681.9824ZM30.7619,56.2291h7.6632c-.1465-.9942-.5522-1.8364-1.2171-2.5031-.6649-.6666-1.5326-1.0058-2.6145-1.0058s-1.9496.3392-2.6145,1.0058c-.6423.6667-1.048,1.5089-1.2171,2.5031Z"
        />
        <path
          d="M17.0811,67.6446v-16.328h1.6904v1.8714c.4169-.6433.9579-1.1345,1.6227-1.4971.6762-.3743,1.4763-.5614,2.4117-.5614,1.0931,0,2.051.269,2.8624.8187.8227.5263,1.465,1.2515,1.9158,2.1755.4508.9006.6762,1.9182.6762,3.0411,0,1.1228-.2254,2.117-.6762,3.041s-1.0931,1.6492-1.9158,2.1989c-.8114.5263-1.7693.7953-2.8624.7953-.9354,0-1.7355-.1871-2.4117-.5614-.6648-.386-1.2058-.9006-1.6227-1.5205v6.5265h-1.6904ZM22.5805,61.6093c.8452,0,1.5552-.1988,2.1412-.6082.5973-.4093,1.0593-.9474,1.3748-1.614.3156-.6901.4733-1.427.4733-2.2223,0-.7954-.1577-1.5557-.4733-2.2223-.3155-.6667-.7775-1.2048-1.3748-1.6141-.586-.4094-1.296-.6082-2.1412-.6082s-1.5326.1988-2.1186.6082c-.586.4093-1.0256.9474-1.3298,1.6141-.3043.6666-.4508,1.4152-.4508,2.2223,0,.807.1465,1.5322.4508,2.2223.3042.6666.7438,1.2047,1.3298,1.614.586.4094,1.2959.6082,2.1186.6082Z"
        />
        <path
          d="M7.95289,63.2c-1.12694,0-2.15244-.1988-3.0878-.6082-.93536-.4093-1.73548-.9708-2.41164-1.7076-.66489-.7369-1.17202-1.579-1.53263-2.5264-.36062-.9708-.54093-2.0001-.54093-3.0878,0-1.0878.18031-2.1405.54093-3.0879.36061-.9474.86774-1.7895,1.53263-2.5264.67616-.7368,1.47628-1.2982,2.41164-1.7076.93536-.4094,1.96086-.6082,3.0878-.6082s2.15241.1988,3.08781.6082c.9353.4094,1.7242.9708,2.3891,1.7076.6762.7369,1.1945,1.579,1.5552,2.5264.3606.9474.5409,1.9767.5409,3.0879,0,1.1111-.1803,2.117-.5409,3.0878-.3607.9474-.879,1.7895-1.5552,2.5264-.6649.7368-1.4538,1.2983-2.3891,1.7076-.9354.4094-1.96087.6082-3.08781.6082ZM7.95289,61.4924c1.21709,0,2.26511-.269,3.13291-.8188.8902-.5614,1.5664-1.3099,2.0285-2.2456.4845-.9474.7212-2.0001.7212-3.158,0-1.158-.2367-2.2223-.7212-3.158-.4621-.9357-1.1383-1.6726-2.0285-2.2223-.8678-.5615-1.91582-.8422-3.13291-.8422s-2.2426.2807-3.13288.8422c-.89028.5497-1.56644,1.2866-2.05102,2.2223-.46204.9357-.6987,1.9883-.6987,3.158,0,1.1696.23666,2.2106.6987,3.158.48458.9357,1.16074,1.6842,2.05102,2.2456.89028.5498,1.92706.8188,3.13288.8188Z"
        />
      </g>
    </svg>

    <div class="logo-shape">
      <div class="logo-half" v-for="n in 4"><div class="bgpart"></div></div>
    </div>
  </div>
</template>

<style scoped>
svg {
  overflow: visible;
}
path {
  opacity: 0;
  display: block;
  transform-origin: center center;
}
.logo-shape {
  width: 68px;
  height: 36px;
  position: absolute;
  left: 50%;
  margin-left: -34px;
  top: 0;
}
.logo-half {
  position: absolute;
  left: 0;
  top: 0;
  width: 18px;
  height: 36px;
  > div {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    border-radius: 0 36px 36px 0;
    /*     background-color: red !important;
 */
  }
}
@media (max-width: 1024px) {
  .logo-shape {
    transform: scale(0.78);
    transform-origin: left top;
  }
  .logo-letters {
    transform: scale(0.8) translate(104px, -37px);
    transform-origin: left top;
  }
}
</style>
